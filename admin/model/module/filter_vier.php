<?php class ModelModuleFilterVier extends Model{private $sort_hand_link=true;private $new_pars=1;private $ignor_pust=false;private $flag_diap=false;private $control_pusto=false;private $diap_step=1;private $del_tire=false;private $tbl_pa=false;private $text_translit='translit';private $param_text='param';private $lang_text='lang';private $prod_attr='prod_attr';private $t_int='int';private $count_chunk=750;private $contr_lang;private $arr_lang;private $colums=true;private $poles_landing=array('title','meta_descr','keywords','meta_h1','discrib');private $language_id;private $flag_s=1;private $poles_count=100;private $arr_replace=array('а'=>'a','б'=>'b','в'=>'v','г'=>'g','д'=>'d','э'=>'e','ё'=>'e','е'=>'e','ж'=>'j','з'=>'z','ы'=>'i','и'=>'i','й'=>'y','к'=>'k','л'=>'l','м'=>'m','н'=>'n','о'=>'o','п'=>'p','р'=>'r','с'=>'s','т'=>'t','у'=>'u','ф'=>'f','х'=>'h','ц'=>'c','щ'=>'sch','ш'=>'sh','ч'=>'ch','я'=>'ya','ю'=>'yu','ъ'=>'','ь'=>'','і'=>'i','ї'=>'i','є'=>'e','ä'=>'a','ö'=>'o','ü'=>'u','û'=>'u','è'=>'e','é'=>'e','ß'=>'s','Ø'=>'d','∅'=>'','ø'=>'d','¹'=>'1','²'=>'2','³'=>'3','°'=>'','—'=>'-','´'=>'','~'=>'-','&quot'=>'','&nbsp;'=>'',' '=>'-','_'=>'-','"'=>'',"'"=>'','`'=>'','>'=>'','<'=>'','='=>'-','!'=>'-','@'=>'-','#'=>'','$'=>'','%'=>'','&'=>'-','?'=>'','('=>'',')'=>'','['=>'',']'=>'','{'=>'','}'=>'','+'=>'-plus-',';'=>'-','.'=>'-',','=>'-','№'=>'',':'=>'','^'=>'','/'=>'-','|'=>'-','\\'=>'-','*'=>'-');public function __construct($registry){parent::__construct($registry);$this->arr_lang=$this->getLangs();if(isset($this->request->post['filter_vier_url_set']['del_tire'])){$this->del_tire=true;}$this->language_id=(int)$this->config->get('config_language_id');}public function polesCount(){return $this->poles_count;}public function newPars(){return $this->new_pars;}public function controlPusto(){return $this->control_pusto;}public function textTranslit(){return $this->text_translit;}public function diapazon(){return $this->flag_diap;}public function polesLanding(){return $this->poles_landing;}public function colum_(){return $this->colums;}public function flagS(){return $this->flag_s;}public function whereImplode($pole,$arr=array(),$and='AND'){$result='';if(!empty($arr)){$arr=array_unique($arr);asort($arr);$result=" ".$and." ".$pole." IN(".implode(',',$arr).")";}return $result;}public function jsDecod($str){$str=htmlspecialchars_decode($str);return json_decode($str,true);}public function stripTags($text,$flag=true){return($flag)?htmlentities(trim(strip_tags(html_entity_decode($text,ENT_QUOTES,'UTF-8'))),ENT_QUOTES,'UTF-8'):$text;}public function getOptions($language_id=null,$where_opt=null){$poles=" od.`option_id`,od.`name` AS name_group,ovd.`option_value_id`,ovd.`name` AS name_option ";$where=null;$language_id=(empty($language_id))?$this->language_id:(int)$language_id;if(!empty($where_opt)){$where_opt.=' AND ';}$where.=" WHERE ".$where_opt." od.`language_id`=".$language_id." AND ovd.`language_id`=".$language_id." ";$query_str="SELECT ".$poles." FROM `".DB_PREFIX."option` o LEFT JOIN `".DB_PREFIX."option_description` od ON(o.`option_id`=od.`option_id`)LEFT JOIN `".DB_PREFIX."option_value_description` ovd ON(od.`option_id`=ovd.`option_id`)".$where." GROUP BY ovd.`option_value_id` ORDER BY o.`sort_order`,ovd.`name` ASC ";$query=$this->db->query($query_str);return $query->rows;}public function getAttributes($lang_id=null,$where_attr=null,$sort=false){$language_id=(empty($lang_id))?$this->language_id:(int)$lang_id;$poles=" agd.`attribute_group_id`,agd.`name` AS name_group,a.`attribute_id`,ad.`name` AS name_attr ";$sort_text=null;$sql=null;$where_lang_pa=null;$group_by=null;$flag_tabl=false;if(strlen($where_attr)>3){$where_attr.=' AND ';}if($this->tbl_pa){$sql.=" JOIN `".DB_PREFIX."product_attribute` pa ON(pa.`attribute_id`=a.`attribute_id`)";}$where_no_attr=null;if($this->ignor_pust){$where_no_attr=" AND agd.`name`<>'' AND ad.`name`<>'' ";}$query_str="SELECT ".$poles." FROM `".DB_PREFIX."attribute` a LEFT JOIN `".DB_PREFIX."attribute_description` ad ON(a.`attribute_id`=ad.`attribute_id`)LEFT JOIN `".DB_PREFIX."attribute_group_description` agd ON(a.`attribute_group_id`=agd.`attribute_group_id`)";$query_str.=$sql;$query_str.=" WHERE ".$where_attr." ad.`language_id`=".$language_id." AND agd.`language_id`=".$language_id.$where_lang_pa.$where_no_attr;$query_str.=$group_by;if($sort){$sort_group=" agd.`attribute_group_id`";if($flag_tabl){$sort_group="ag.`sort_order`";}$query_str.=" ORDER BY ".$sort_group.",a.`sort_order`".$sort_text;}else{$query_str.=" ORDER BY name_group,name_attr";}$query=$this->db->query($query_str);return $query->rows;}public function getAttribSeo($lang_id=null,$where_attr=null,$sort=false){$language_id=(empty($lang_id))?$this->language_id:(int)$lang_id;$poles=" agd.`attribute_group_id`,agd.`name` AS name_group,a.`attribute_id`,ad.`name` AS name_attr ";$sort_text=null;$sql=null;$where_lang_pa=null;$group_by=null;$flag_tabl=false;if(is_string($where_attr)){$flag_tabl=true;$sql.=" LEFT JOIN `".DB_PREFIX."attribute_group` ag ON(a.`attribute_group_id`=ag.`attribute_group_id`)";$poles.=",afv.`attr_text`,afv.`text_id`,afvl.`text` ";$sort_text=",(afvl.`text`+0),afvl.`text`";$sql.=" JOIN `".DB_PREFIX."attribute_filter_vier` afv ON(a.`attribute_id`=afv.`attribute_id`)";$sql.=" JOIN `".DB_PREFIX."attribute_filter_vier_lang` afvl ON(afv.`attr_text`=afvl.`attr_text`)";$where_lang_pa=" AND afvl.`language_id`=".$language_id;if(strlen($where_attr)>3){$where_attr.=' AND ';}}$where_no_attr=null;if($this->ignor_pust){$where_no_attr=" AND agd.`name`<>'' AND ad.`name`<>'' ";}$query_str="SELECT ".$poles." FROM ";$query_str.=" `".DB_PREFIX."attribute` a ";$query_str.=" LEFT JOIN `".DB_PREFIX."attribute_description` ad ON(a.`attribute_id`=ad.`attribute_id`)";$query_str.=" LEFT JOIN `".DB_PREFIX."attribute_group_description` agd ON(a.`attribute_group_id`=agd.`attribute_group_id`)";$query_str.=$sql;$query_str.=" WHERE ".$where_attr." ad.`language_id`=".$language_id." AND agd.`language_id`=".$language_id.$where_lang_pa.$where_no_attr;$group_by.=" GROUP BY attr_text ";$query_str.=$group_by;if($sort){$sort_group=" agd.`attribute_group_id`";if($flag_tabl){$sort_group="ag.`sort_order`";}$query_str.=" ORDER BY ".$sort_group.",a.`sort_order`".$sort_text;}else{$query_str.=" ORDER BY name_group,name_attr";}$query=$this->db->query($query_str);return $query->rows;}private function slitDelit($text,$sep,$flag_html=false){if($flag_html){$text=$this->stripTags($text,$flag_html);}return explode($sep,$text);}private function genAttrId($attribute_rows,$lang_id,$flag_sep,$sep,$diap_mark,$diap_step,$flag_html,$result=array(),$flag=''){$prod_attr=$this->prod_attr;$l_text=$this->lang_text;$p_text=$this->param_text;$k_text='key_text';$t_int=$this->t_int;$step_n=$this->diap_step;$flag_arr_step=false;if(is_array($diap_step)&&!empty($diap_step)){$flag_arr_step=true;}elseif(is_numeric($diap_step)){$step_n=$diap_step;}if(empty($diap_mark)){$this->flag_diap=false;}if($flag){${'result'.$flag}=array();}foreach($attribute_rows as $column){$main_id=(int)$column['attribute_id'];$product_id=(int)$column['product_id'];$n_text=trim($column['text']);if(strlen($n_text)==0){$text_id=0;$a_t=$main_id.'_'.$text_id;$result[$main_id][$l_text][$lang_id][$a_t]=$n_text;if(!$flag){$result[$main_id][$k_text][$n_text]=$text_id;$result[$main_id][$p_text][$product_id][$text_id]=$a_t;$result[$main_id][$t_int][$product_id][$text_id]=$n_text;}}else{$arr_diap_all=array();if($this->flag_diap&&(strpos($n_text,$diap_mark)!==false)){$arr_diap=explode($diap_mark,$n_text);$min_d=trim(min($arr_diap));$max_d=trim(max($arr_diap));if($flag_arr_step&&isset($diap_step[$main_id])){$step=$diap_step[$main_id];}else{$step=$step_n;}if(($step<$max_d)&&(($max_d-$min_d)>=$step)){$arr_diap_all=range($min_d,$max_d,$step);}}if($arr_diap_all ||($flag_sep&&(strpos($n_text,$sep)!==false))){if($arr_diap_all){$arr_text=$arr_diap_all;}else{$arr_text=$this->slitDelit($n_text,$sep);}if(is_array($arr_text)){foreach($arr_text as $text_cor1){$n_text1=trim($text_cor1);if(strlen($n_text1)==0){continue;}$text_cor1=$this->attribTextCorrect($this->stripTags($n_text1,$flag_html));if(isset(${'result'.$flag}[$main_id][$k_text])){if(isset(${'result'.$flag}[$main_id][$k_text][$text_cor1])){$text_id=${'result'.$flag}[$main_id][$k_text][$text_cor1];}else{$text_id=(count(${'result'.$flag}[$main_id][$k_text])+1);}}else{$text_id=1;}${'result'.$flag}[$main_id][$k_text][$text_cor1]=$text_id;$a_t=$main_id.'_'.$text_id;$result[$main_id][$l_text][$lang_id][$a_t]=$n_text1;if(!$flag){$result[$main_id][$p_text][$product_id][$text_id]=$a_t;$result[$main_id][$t_int][$product_id][$text_id]=$n_text1;}}}}else{$text_cor=$this->attribTextCorrect($this->stripTags($n_text,$flag_html));if(isset(${'result'.$flag}[$main_id][$k_text])){if(isset(${'result'.$flag}[$main_id][$k_text][$text_cor])){$text_id=${'result'.$flag}[$main_id][$k_text][$text_cor];}else{$text_id=(count(${'result'.$flag}[$main_id][$k_text])+1);}}else{$text_id=1;}${'result'.$flag}[$main_id][$k_text][$text_cor]=$text_id;$a_t=$main_id.'_'.$text_id;$result[$main_id][$l_text][$lang_id][$a_t]=$n_text;if(!$flag){$result[$main_id][$p_text][$product_id][$text_id]=$a_t;$result[$main_id][$t_int][$product_id][$text_id]=$n_text;}}}}return $result;}public function genCodeAttributes($where_attr='',$sep=null,$flag_sep=false,$diap_mark,$diap_step,$flag_html=false){$result=array();$prod_attr=$this->prod_attr;$l_text=$this->lang_text;$p_text=$this->param_text;$k_text='key_text';$t_int=$this->t_int;$arr_lang=$this->arr_lang;$lang_id=$this->language_id;foreach($arr_lang as $key=>$val){if($lang_id==$val['language_id']){unset($arr_lang[$key]);break;}}$attribute_rows=$this->getProdAttrLang($lang_id,$where_attr);$result=$this->genAttrId($attribute_rows,$lang_id,$flag_sep,$sep,$diap_mark,$diap_step,$flag_html);if(!empty($result)){if(!empty($arr_lang)){foreach($arr_lang as $k=>$val){$lang_id=$val['language_id'];$attribute_rows=$this->getProdAttrLang($lang_id,$where_attr);$result=$this->genAttrId($attribute_rows,$lang_id,$flag_sep,$sep,$diap_mark,$diap_step,$flag_html,$result,'1');}}}return $result;}private function getProdAttrLang($language_id,$where_attr=null){$tabl='product_attribute';$poles=" `product_id`,`attribute_id`,`text` ";if(!empty($where_attr)){$where_attr.=" AND ";}$this->db->query("OPTIMIZE TABLE `".DB_PREFIX.$tabl."`");$query_str="SELECT ".$poles." FROM `".DB_PREFIX.$tabl."` a WHERE ".$where_attr." `language_id`=".(int)$language_id." ";$query_str.=" ORDER BY `product_id` ";$query=$this->db->query($query_str);return $query->rows;}public function addAttribFV($arr_attr){$result=false;if(!$arr_attr)return $result;$p_text=$this->param_text;$t_int=$this->t_int;$tabl='attribute_filter_vier';$ins_v=array();foreach($arr_attr as $k_a=>$at){foreach($at[$p_text] as $k_p=>$vt){foreach($vt as $k_t=>$t){$text_int=0;$text=$arr_attr[$k_a][$t_int][$k_p][$k_t];if(is_numeric($text)&&is_finite($text*1)){$text_int=$text;}$ins_v[]="(".$k_p.",".$k_a.",'".$t."',".$k_t.",".$text_int.")";}}}$arr_chunk=array_chunk($ins_v,$this->count_chunk);if($arr_chunk){$this->db->query("TRUNCATE TABLE `".DB_PREFIX.$tabl."`");$result=true;foreach($arr_chunk as $val){$str=implode(',',$val);$query_str="INSERT INTO `".DB_PREFIX.$tabl."`(`product_id`,`attribute_id`,`attr_text`,`text_id`,`text_int`)VALUES ".$str."";$res=$this->db->query($query_str);if(!$res){$result=false;}}if($result){$this->db->query("OPTIMIZE TABLE `".DB_PREFIX.$tabl."`");}}return $result;}public function addAttribLang($arr_attr){$result=false;if(!$arr_attr)return $result;$l_text=$this->lang_text;$tabl='attribute_filter_vier_lang';$ins_v=array();foreach($arr_attr as $k_a=>$at){foreach($at[$l_text] as $k_p=>$vt){foreach($vt as $k_t=>$t){$ins_v[]="(".$k_a.",".$k_p.",'".$k_t."','".$this->db->escape($t)."')";}}}$arr_chunk=array_chunk($ins_v,$this->count_chunk);if($arr_chunk){$this->db->query("TRUNCATE TABLE `".DB_PREFIX.$tabl."`");$result=true;foreach($arr_chunk as $val){$str=implode(',',$val);$query_str="INSERT INTO `".DB_PREFIX.$tabl."`(`attribute_id`,`language_id`,`attr_text`,`text`)VALUES ".$str."";$res=$this->db->query($query_str);if(!$res){$result=false;}}if($result){$this->db->query("OPTIMIZE TABLE `".DB_PREFIX.$tabl."`");}}return $result;}private function attribTextCorrect($text){return mb_strtolower($text,'UTF-8');}public function seoBrand($trans=true){$result=array();$where=null;if($this->ignor_pust){$where.=" WHERE `name`<>'' ";}$query=$this->db->query("SELECT `manufacturer_id`,`name` FROM `".DB_PREFIX."manufacturer` ".$where." ORDER BY `name`");if($trans){foreach($query->rows as $column){$key_id=$column['manufacturer_id'];$result[$key_id]=array('manufacturer_id'=>$key_id,'name'=>$column['name'],$this->text_translit=>$this->translitEng($column['name']));}}else{$main_key='manufs';$filter_vier_transl=$this->urlMainFV($main_key);foreach($query->rows as $column){$key_id=$column['manufacturer_id'];if(isset($filter_vier_transl[1][$key_id])){$seo_url=$filter_vier_transl[1][$key_id];}else{$seo_url=null;}$result[$key_id]=array('manufacturer_id'=>$key_id,'name'=>$column['name'],$this->text_translit=>$seo_url);}}return $result;}public function getLangs($versi_cms=1){$result=array();$query=$this->db->query("SELECT*FROM `".DB_PREFIX."language` WHERE `status`=1 ORDER BY `sort_order`,`name`");$i=0;$k=$k_stat=-4;$patt='*.{png,jpg,gif}';foreach($query->rows as $colum){if(($colum['code']=='en')||($colum['code']=='en-gb')||($colum['code']=='ru')||($colum['code']=='ru-ru')||($colum['code']=='ua')||($colum['code']=='ua-ua')){$p=$k++;}else{$p=$i++;}if($versi_cms){$src_img='view/image/flags/'.$colum['image'];}else{$src_img='language/'.$colum['code'].'/'.$colum['code'].'.png';if(!file_exists($src_img)){$src_img='';$files=glob("language/".$colum['code']."/".$patt,GLOB_BRACE);if(isset($files[0])){$src_img=is_string($files[0])?$files[0]:'';}}}$result[$p]=array('language_id'=>(int)$colum['language_id'],'name'=>$colum['name'],'code'=>$colum['code'],'locale'=>$colum['locale'],'image'=>$colum['image'],'directory'=>$colum['directory'],'sort_order'=>$colum['sort_order'],'status'=>$colum['status'],'src_img'=>$src_img);}$this->contr_lang=($k>$k_stat)?true:false;$this->contrLang();ksort($result);return $result;}public function contrLang(){return $this->contr_lang;}public function clearTableUFV(){$result=array();$tabl='url_filter_vier';$rez=$this->db->query("TRUNCATE TABLE `".DB_PREFIX.$tabl."`");if(!$rez){$result[$tabl]=false;}return $result;}public function addDiscript($discripts,$lang_description=array()){$result=false;$tabl='filter_vier_description';$this->db->query("TRUNCATE TABLE `".DB_PREFIX.$tabl."`");foreach($discripts as $lang_id=>$discript){$discr=$this->db->escape($discript['description']);$serial=base64_encode(serialize($this->getArrMark($discr)));$lang=base64_encode(serialize($lang_description[$lang_id]));$res=$this->db->query("INSERT INTO `".DB_PREFIX.$tabl."` SET `language_id`=".(int)$lang_id.",`description`='".$discr."',`serializi`='".$serial."',`serial_legend`='".$lang."' ");$result=true;if($res===false){$result=false;}}return $result;}public function getDiscriptions(){$result=array();$tabl='filter_vier_description';$query=$this->db->query("SELECT `language_id`,`description`,`serial_legend` FROM `".DB_PREFIX.$tabl."`");foreach($query->rows as $colum){$result['description'][$colum['language_id']]=array('language_id'=>$colum['language_id'],'description'=>$colum['description']);if($serial_legend=base64_decode($colum['serial_legend'],true)){$result['lang'][$colum['language_id']]=@unserialize($serial_legend);}else{$result['lang'][$colum['language_id']]=array();}}return $result;}public function addDiscriptHang($discripts){$tabl='filter_vier_hand_links';$pole='link';$arr_pole=$this->poles_landing;$ins_v=array();$contrl=array();$contrl_1=array();foreach($discripts as $k=>$discript){$lc=$link=trim($discript[$pole]);if(empty($link))continue;$link="'".$this->db->escape($link)."'";$discrib='';foreach($arr_pole as $v){$discrib.=",'".base64_encode(serialize($discript[$v]))."'";}$ins_v[]="(".$link.$discrib.")";if(isset($contrl[$lc])){$contrl_1[$k]=$lc;}$contrl[$lc]=$lc;}if(!empty($contrl_1)){$result=array();$result['duble']=$contrl_1;}else{$result=true;$arr_chunk=array_chunk($ins_v,$this->count_chunk);$result=$this->db->query("TRUNCATE TABLE `".DB_PREFIX.$tabl."`");if($arr_chunk){$poles="`".$pole."`";foreach($arr_pole as $v){$poles.=",`".$v."`";}foreach($arr_chunk as $val){$str=implode(',',$val);$query_str="INSERT INTO `".DB_PREFIX.$tabl."`(".$poles.")VALUES ".$str."";$res=$this->db->query($query_str);if(!$res){$result=false;}}if($result){$this->db->query("OPTIMIZE TABLE `".DB_PREFIX.$tabl."`");}}}return $result;}public function getDiscriptHang(){$result=array();$tabl='filter_vier_hand_links';$pole='link';$arr_pole=$this->poles_landing;$poles="`".$pole."`";foreach($arr_pole as $v){$poles.=",`".$v."`";}$query_str="SELECT ".$poles." FROM `".DB_PREFIX.$tabl."`";if($this->sort_hand_link){$query_str.=" ORDER BY `".$pole."`";}$query=$this->db->query($query_str);foreach($query->rows as $colum){$arr_temp=array($pole=>$colum[$pole]);$arr_discr=array();foreach($arr_pole as $val){if($serial_legend=base64_decode($colum[$val],true)){$arr_discr[$val]=@unserialize($serial_legend);}else{$arr_discr[$val]=array();}}$result[]=array_merge($arr_temp,$arr_discr);}return $result;}public function getArrMark($str){$m_l='[';$m_r=']';$arr_mark=array();$preg_shab='[A-Za-z0-9-_]+?';$search='(.+?)';$shabl='/'.preg_quote($m_l).$preg_shab.preg_quote($m_l).$search.preg_quote($m_r).'\/'.$preg_shab.preg_quote($m_r).'/';preg_match_all($shabl,$str,$markers,PREG_SET_ORDER);foreach($markers as $k=>$val){preg_match('/'.preg_quote($m_l).'('.$preg_shab.')'.preg_quote($m_l).'/',$val[0],$mark);$arr_mark[trim($mark[1])]=trim($val[1]);}return $arr_mark;}public function addTranslit($url_translit){$result=false;$tabl='url_filter_vier';$ins_v=array();if($this->control_pusto){foreach($url_translit as $main_key=>$val){foreach($val as $main_id=>$seo_urls){foreach($seo_urls as $key_id=>$seo_url){if(strlen(trim($seo_url))==0){unset($url_translit[$main_key][$main_id]);break 1;}}}}}foreach($url_translit as $main_key=>$val){foreach($val as $main_id=>$seo_urls){foreach($seo_urls as $key_id=>$seo_url){if($seo_url=trim($seo_url)){$key_param=$main_key.'_'.$main_id.'_'.$key_id;$key_param1=$main_key.'='.$main_id.'_'.$seo_url;$ins_v[]="('".$main_key."','".$key_param."','".$key_param1."',".$main_id.",".$key_id.",'".$this->db->escape($seo_url)."')";}}}}$arr_chunk=array_chunk($ins_v,$this->count_chunk);if($arr_chunk){$this->db->query("TRUNCATE TABLE `".DB_PREFIX.$tabl."`");$result=true;foreach($arr_chunk as $val){$str=implode(',',$val);$query_str="INSERT INTO `".DB_PREFIX.$tabl."`(`main_key`,`key_param`,`key_param1`,`main_id`,`key_id`,`seo_url`)VALUES ".$str."";$res=$this->db->query($query_str);if(!$res){$result=false;}}if($result){$this->db->query("OPTIMIZE TABLE `".DB_PREFIX.$tabl."`");}}return $result;}public function urlFV(){$result=array();$tabl='url_filter_vier';$query=$this->db->query("SELECT `main_key`,`key_param`,`key_param1`,`main_id`,`key_id`,`seo_url` FROM `".DB_PREFIX.$tabl."`");foreach($query->rows as $colum){$result[$colum['main_key']][$colum['main_id']][$colum['key_id']]=$colum['seo_url'];}return $result;}public function urlMainFV($main_key,$flag_main=false){$result=array();$tabl='url_filter_vier';$where_dop=($flag_main)?" AND `main_id`=1 AND `key_id`=0 ":null;$where=" WHERE `main_key`='".$main_key."' ".$where_dop;$query=$this->db->query("SELECT `main_id`,`key_id`,`seo_url` FROM `".DB_PREFIX.$tabl."`".$where);foreach($query->rows as $colum){$result[$colum['main_id']][$colum['key_id']]=$colum['seo_url'];}return $result;}public function translitEng($russ_str){if(strlen($russ_str)==0)return '';$russ_str=mb_strtolower(trim(html_entity_decode($russ_str,ENT_QUOTES,'UTF-8')),'UTF-8');$translit=strtr($russ_str,$this->arr_replace);$translit=preg_replace('~[^-a-z0-9]+~u','-',$translit);if($this->del_tire){$translit=trim(preg_replace('/-+/u','-',$translit),'-');if($translit=='')$translit='-';}$translit=substr($translit,0,150);return $translit;}public function showColum($tabl){$arr=array();$query_str="SHOW COLUMNS FROM `".DB_PREFIX.$tabl."`";$query=$this->db->query($query_str);if($query->num_rows){foreach($query->rows as $colum){$arr[]=$colum['Field'];}}return $arr;}public function urlAliasBase(){$result=array();$poles=" `keyword` ";$query=$this->db->query("SELECT ".$poles." FROM `".DB_PREFIX."url_alias` WHERE `keyword`<>''");foreach($query->rows as $keyword){$result[]=$keyword['keyword'];}return $result;}}?>